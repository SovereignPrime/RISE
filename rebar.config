% vim: ft=erlang ts=4 sw=4 et
{erl_opts, [
            debug_info
           ]}.
{deps, [
    {simple_bridge, {git, "git://github.com/SovereignPrime/simple_bridge",{branch, master}}},
    {nitrogen_core, {git, "git://github.com/SovereignPrime/nitrogen_core", {branch, master}}},
    {nprocreg,      {git, "git://github.com/nitrogen/nprocreg",     {tag, "v0.2.1"}}},
    {cowboy,        {git, "git://github.com/extend/cowboy",         {tag, "1.0.1"}}},
    {mochijson2,    {git, "git://github.com/bjnortier/mochijson2.git", {ref, "3663fb01fd98958181adc2d1300c7bfa553e1434"}}},
    {bitmessage, {git, "git://github.com/SovereignPrime/BitMessage.erl.git", {branch, "develop"}}},
    %{eminer, {git, "ssh://git@github.com/t1ha/eminer.git", {branch, "develop"}}},
    {lager, {git, "git://github.com/basho/lager.git", {branch, master}}},
    {sigma_search, {git, "git://github.com/SovereignPrime/sigma_search.git", {branch, "master"}}},
    {sync, {git, "git://github.com/rustyio/sync", {ref, "a8366be73244383c07f9cafe30b72e83f3ad0621"}}}
]}.


{pre_hooks, [
             {"(linux|win32)", release, "make qt"},
             {"darwin", release, "make xcode"}
            ]}.

{post_hooks, [
             {"linux", release, "make -C \"$REBAR_BUILD_DIR/rel\" deb"},
             {"win32", release, "make setup"},
             {"darwin", release, "make -C \"$REBAR_BUILD_DIR/rel\" dmg"}
            ]}.

{relx, [
        {overlay_vars, "config/vars.config"},
        {overlay, [
                   {copy, "config", "etc"},
                   {copy, "apps/rise/templates", "site/templates"},
                   {copy, "apps/rise/static", "site/static"}
                  ]},
        %{sys_config, "./config/simple_bridge.config"},

        {dev_mode, true},
        {include_erts, false},
        {system_libs, false}

       ]}.


{config, "./config/bitmessage.config"}.
{config, "./config/dev.config"}.
{shell_apps, [rise, sync]}.

{profiles, [
            {lin, [{relx, [{release, {'rise', "0.1.6"},
                            [
                             {lager, load},
                             {hottub, load},
                             {bitmessage, load},
                             {mnesia, load},
                             {inets, none},
                             {cowboy, load},
                             {simple_bridge, load},
                             {nprocreg, load},
                             {nitrogen_core, load},
                             {sigma_search, load},
                             'rise'
                            ]},
                           {dev_mode, false},
                           {include_erts, true},
                           {sys_config, "./config/sys.config"},
                           {vm_args, "./config/vm.args"},
                           {system_libs, true},
                           {extended_start_script, false},
                           {overlay, [
                                      {copy, "config", "etc"},
                                      {copy, "apps/rise/templates", "site/templates"},
                                      {copy, "apps/rise/static", "site/static"},
                                      {template, "config/vm.args", "etc/vm.args"},
                                      {copy, "frontend/rise", "bin/rise"},
                                      {copy, "meta/deb", "../rise-{{rel_vsn}}"},
                                      {copy, "frontend/rise", "../rise-{{rel_vsn}}/usr/bin/rise"},
                                      {template, "meta/deb/DEBIAN/control", "../rise-{{rel_vsn}}/DEBIAN/control"},
                                      {template, "Makefile", "../Makefile"},
                                      {copy, "{{output_dir}}", "../rise-{{rel_vsn}}/usr/lib"}
                                     ]}
                          ]}]
            },
            {dev, [{relx, [{release, {'rise', "0.1.6"},
                            [
                             {lager, load},
                             {hottub, load},
                             {bitmessage, load},
                             {mnesia, load},
                             {inets, none},
                             {cowboy, load},
                             {simple_bridge, load},
                             {nprocreg, load},
                             {nitrogen_core, load},
                             {sigma_search, load},
                             {runtime_tools, none},
                             {observer, none},
                             {wx, none},
                             {sync, none},
                             'rise'
                            ]},
                           {dev_mode, true},
                           {include_erts, true},
                           {sys_config, "./config/sys.config"},
                           {vm_args, "./config/vm.args"},
                           {system_libs, true},
                           {extended_start_script, false},
                           {overlay, [
                                      {copy, "config", "etc"},
                                      {copy, "apps/rise/templates", "site/templates"},
                                      {copy, "apps/rise/static", "site/static"},
                                      {template, "config/vm.args", "etc/vm.args"},
                                      {copy, "frontend/rise", "bin/rise"}
                                     ]}
                          ]}]
            },
            {mac, [{relx, [{release, {'rise', "0.1.6"},
                            [
                             {lager, load},
                             {hottub, load},
                             {bitmessage, load},
                             {mnesia, load},
                             {inets, none},
                             {cowboy, load},
                             {simple_bridge, load},
                             {nprocreg, load},
                             {nitrogen_core, load},
                             {sigma_search, load},
                             'rise'
                            ]},
                           {dev_mode, false},
                           {include_erts, true},
                           {sys_config, "./config/sys.config"},
                           {vm_args, "./config/vm.args"},
                           {system_libs, true},
                           {extended_start_script, false},
                           {overlay, [
                                      {copy, "frontend/build/Release/RISE.app", "../Release/RISE.app"},
                                      {template, "frontend/build/Release/RISE.app/Contents/Info.plist", "../Release/RISE.app/Contents/Info.plist"},
                                      {copy, "{{output_dir}}", "../Release/RISE.app/Contents/Backend"},
                                      {copy, "config", "../Release/RISE.app/Contents/Backend/etc"},
                                      {copy, "apps/rise/templates", "../Release/RISE.app/Contents/Backend/site/templates"},
                                      {copy, "apps/rise/static", "../Release/RISE.app/Contents/Backend/site/static"},
                                      {template, "Makefile", "../Makefile"},
                                      {template, "config/vm.args", "../Release/RISE.app/Contents/Backend/etc/vm.args"}
                                     ]}
                          ]}]
            },
            {win, [{relx, [{release, {'rise', "0.1.6"},
                            [
                             {lager, load},
                             {hottub, load},
                             {bitmessage, load},
                             {mnesia, load},
                             {inets, none},
                             {cowboy, load},
                             {simple_bridge, load},
                             {nprocreg, load},
                             {nitrogen_core, load},
                             {sigma_search, load},
                             'rise'
                            ]},
                           {dev_mode, false},
                           {include_erts, true},
                           {sys_config, "./config/sys.config"},
                           {vm_args, "./config/vm.args"},
                           {system_libs, true},
                           {extended_start_script, false},
                           {overlay, [
                                      {copy, "config", "etc"},
                                      {copy, "apps/rise/templates", "site/templates"},
                                      {copy, "apps/rise/static", "site/static"},
                                      {template, "config/vm.args", "etc/vm.args"},
                                      {copy, "frontend/release/rise.exe", "bin/rise.exe"},
                                      {template, "meta/win/rise.iss", "../rise.iss"}
                                     ]}
                          ]}]
            },
            {default, [
                       {relx, [{release, {'rise', "0.1.6"},
                                [
                                 cowboy,
                                 nprocreg,
                                 nitrogen_core,
                                 bitmessage,
                                 lager,
                                 simple_bridge,
                                 sigma_search,
                                 wx,
                                 runtime_tools,
                                 observer,
                                 'rise'
                                ]},
                               {overlay_vars, "config/vars.config"},
                               {overlay, [
                                          {copy, "config", "etc"},
                                          {copy, "apps/rise/templates", "site/templates"},
                                          {copy, "apps/rise/static", "site/static"}
                                         ]},

                               {sys_config, "./config/dev.config"},
                               {config, "./config/bitmessage.config"},
                               {vm_args, "./config/dev.args"},

                               {dev_mode, true},
                               {include_erts, false},
                               {system_libs, false},

                               {extended_start_script, true}]
                       }]}
           ]
}.
